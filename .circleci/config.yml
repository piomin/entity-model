version: 2.1

jobs:
  build:
    parameters:
      app-version:
        type: env_var_name
        default: APP_VERSION
    docker:
      - image: 'cimg/openjdk:11.0'
    steps:
      - checkout
      - run:
          name: Analyze on SonarCloud
          command: mvn verify sonar:sonar
      - run:
          name: Get version
          command: |
            APP_VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)
            echo -n $APP_VERSION
      - gh/install
      - run:
          command: >
            echo -n ${<< parameters.app-version >>}

executors:
  jdk:
    docker:
      - image: 'cimg/openjdk:11.0'

orbs:
  gh: circleci/github-cli@1.0

workflows:
  maven_test:
    jobs:
      - build:
          context: SonarCloud